<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>GROMACSチュートリアル②mdpファイルの作成とシミュレーションの実行</title>
        <meta name="description" content="【GROMACSのチュートリアル②】mdpファイルの作成とシミュレーションの実行ページ">
        <meta name="viewport" content="width=device-width,initial-scale=1">

    <!-- CSS -->
        <link rel="stylesheet" href="https://unpkg.com/ress@3.0.0/dist/ress.min.css">
        <link rel="stylesheet" href="../css/style.css">
    <!-- JQuery -->
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <script src="../js/menu.js" type="text/javascript"></script>
    <script src="../js/footer.js" type="text/javascript"></script>
    </head>

<body>
    <div class="page-contents">
        <!-- Accordion Menu -->
        <script type="text/javascript">loadMenu('../');</script>
        <!-- MAIN CONTENTS -->
        <div class="main-contents">
            <!-- HEADER IMAGE -->
            <div id="gromacs" class="big-bg">
                <div class="title-contents wrapper">
                    <h2 class="page-title">GROMACS</h2>
                </div>
            </div>

            <!-- CONTENTS -->
            <div class="main-text wrapper">
                <div class="hierarchie">
                    <a href="../index.html"><img class="home-icon" src="../images/logo_original.png" alt="home"></a>
                    <p> ＞ <a href="gromacs_tutorial2_top.html">GROMACSチュートリアル②</a> ＞ mdpファイルの作成とシミュレーションの実行</p>
                </div>
                <div>
                    <h2 class="content-title">【GROMACSチュートリアル②】 mdpファイルの作成とシミュレーションの実行</h2>
                    <p>
                        前回まででアルコール二重膜系を作成し、CHARMM36力場を使用したGROMACSでのシミュレーションを開始できるまでに至った。
                        今回は実際にMDシミュレーションを行うが、シミュレーションの設定をメインに解説し、好きな条件でシミュレーションを実行できるようになることを目標とする。
                        シミュレーションの手順はチュートリアル①と同様、下記のように進めていく。
                    </p>
                    <div id="list" class="table-of-contents">
                        <ol>
                            <li>エネルギー最小化（00_em）</li>
                            <li>NVT平衡化（01_nvt）</li>
                            <li>NPT平衡化（02_npt）</li>
                            <li>本計算（03_npt）</li>
                        </ol>
                    </div>
                    <p>
                        また、このページで解説したmdpファイルの設定について、より詳しい解説は<a href="./gromacs_mdp.html">GROMACS.mdpオプション</a>のページで紹介している。
                        GROMACSの操作に慣れてきたら参考にしてほしい。
                    </p>
                </div>

                <div class="content-block">
                    <h3>エネルギー最小化（00_em）</h3>
                    <p>
                        まずは、作成した構造のエネルギー最小化を行う。
                        設定条件を記述したmdpファイルは次のようになる。
                    </p>
                    
<pre><code><p class="filename">00_em.mdp</p>
integrator  = steep
emtol       = 1000.0
emstep      = 0.01
nsteps      = 50000

nstlist         = 10
cutoff-scheme   = Verlet
ns_type         = grid
coulombtype     = PME
rcoulomb        = 1.2
rvdw            = 1.2
pbc             = xyz
</code></pre>

                    <p>
                        エネルギー最小化には最急降下法を用いるので<code>integrator = steep</code>とし、系の最大力F<sub>max</sub>が1000 kJ mol<sup>-1</sup> nm<sup>-1</sup>以下となるまで緩和を行う。
                        この時、同時にステップ間隔と最大ステップ数を指定している。
                        <br><br>
                        また、次に非結合相互作用（LJ相互作用、クーロン相互作用）に関する設定している。
                        近接原子の定義、探し方、更新頻度などを設定した後、それらが遠距離の場合と近距離の場合で異なる相互作用の取り扱いをしている。
                        <code>coulombtype = PME</code>は遠距離クーロン相互作用にパーティクルメッシュエワルド法を使用する設定である。
                        また、<code>rcoulomb</code>と<code>rvdw</code>は近距離クーロン相互作用及び近距離LJ相互作用のカットオフ距離である。
                        <br><br>
                        最後、<code>pbc = xyz</code>は周期的境界条件を3次元に適用している。
                        <br><br>
                        このmdpファイルと作成した二重膜系の構造を用いて<code>gmx grompp</code>と<code>gmx mdrun</code>を実行する。
                    </p>

<pre><code>gmx grompp -f 00_em.mdp -c system.gro -p topol.top -o 00_em.tpr
gmx mdrun -deffnm 00_em
</code></pre>

                    <p>
                        計算が終了すると、エネルギー最小化された系の構造が得られる。
                        エネルギー最小化過程のポテンシャルエネルギー変化を出力してみた。
                    </p>
                </div>

                <div class="content-block">
                    <h3>NVT平衡化（01_nvt）</h3>
                    <p>
                        エネルギー最小化ができたら、NVT平衡化を行う。
                        mdpファイルには温度制御の設定を記述する必要があり、またシミュレーションの長さに合わせてステップ数を決定する。
                        今回はNose-Hooverの方法で温度制御を行い、310.15 Kで125.0 psのNVT計算を行う設定をした。
                    </p>

<pre><code><p class="filename">01_nvt.mdp</p>
integrator              = md
dt                      = 0.001
nsteps                  = 125000
nstxtcout               = 5000
nstxout                 = 5000
nstvout                 = 5000
nstfout                 = 5000
nstcalcenergy           = 100
nstenergy               = 1000
nstlog                  = 1000

cutoff-scheme           = Verlet
nstlist                 = 20
rlist                   = 1.2
coulombtype             = PME
rcoulomb                = 1.2
vdwtype                 = Cut-off
vdw-modifier            = Force-switch
rvdw_switch             = 1.0
rvdw                    = 1.2

tcoupl                  = Nose-Hoover
tc_grps                 = SYSTEM
tau_t                   = 1.0
ref_t                   = 310.15

constraints             = h-bonds
constraint_algorithm    = LINCS

nstcomm                 = 100
comm_mode               = linear
comm_grps               = SYSTEM

gen-vel                 = yes
gen-temp                = 310.15
gen-seed                = -1

refcoord_scaling        = com
</code></pre>

                    <p>
                        上から順番に見ていく。まず、MD計算を行うので<code>integrator = md</code>とし、タイムステップは<code>dt = 0.001</code>としている。
                        このタイムステップの単位はpsなので、設定したタイムステップは1 fsとなる。
                        <code>nsteps = 125000</code>とすれば、0.001 ps × 125000 = 125.0 psのシミュレーションが実行できる。
                        <br><br>
                        次に出力情報の設定をしている。
                        主にトラジェクトリファイルを何ステップごとに記述するかを設定しており、<code>nstxout</code>、<code>nstvout</code>、<code>nstfout</code>はそれぞれ系の原子の座標、速度及び働く力に対応する。
                        これらの情報はtrrファイルにトラジェクトリとして出力されるが、<code>nstxtcout</code>を指定するとxtcファイルにも座標情報を出力することができる。
                        また、エネルギーや計算ログの出力も<code>nstenergy</code>と<code>nstlog</code>で制御できる。
                        <br><br>
                        温度制御では<code>tcoupl = Nose-Hoover</code>とする。<code>ref_t</code>が参照温度なので、ここに310.15 Kを指定する。
                    </p>



                    <p>
                        
                    </p>

                <div class="content-block">
                    <h3>NPT平衡化（02_npt）</h3>
                    <p>
                        
                    </p>

<pre><code>
integrator              = md
dt                      = 0.002
nsteps                  = 250000
nstxtcout               = 5000
nstvout                 = 5000
nstfout                 = 5000
nstcalcenergy           = 100
nstenergy               = 1000
nstlog                  = 1000

cutoff-scheme           = Verlet
nstlist                 = 20
rlist                   = 1.2
coulombtype             = pme
rcoulomb                = 1.2
vdwtype                 = Cut-off
vdw-modifier            = Force-switch
rvdw_switch             = 1.0
rvdw                    = 1.2

tcoupl                  = Nose-Hoover
tc_grps                 = SYSTEM
tau_t                   = 1.0
ref_t                   = 310.15

pcoupl                  = Parrinello-Rahman
pcoupltype              = semiisotropic
tau_p                   = 5.0
compressibility         = 4.5e-5  4.5e-5
ref_p                   = 1.0     1.0

constraints             = h-bonds
constraint_algorithm    = LINCS
continuation            = yes

nstcomm                 = 100
comm_mode               = linear
comm_grps               = SYSTEM

refcoord_scaling        = com
</code></pre>

                    <p>
                        
                    </p>

                </div>

                <div class="content-block">
                    <h3>本計算（03_npt）</h3>
                    <p>
                        
                    </p>

<pre><code>
integrator              = md
dt                      = 0.002
nsteps                  = 25000000
nstxtcout               = 50000
nstvout                 = 50000
nstfout                 = 50000
nstcalcenergy           = 100
nstenergy               = 1000
nstlog                  = 1000

cutoff-scheme           = Verlet
nstlist                 = 20
rlist                   = 1.2
coulombtype             = pme
rcoulomb                = 1.2
vdwtype                 = Cut-off
vdw-modifier            = Force-switch
rvdw_switch             = 1.0
rvdw                    = 1.2

tcoupl                  = Nose-Hoover
tc_grps                 = SYSTEM
tau_t                   = 1.0
ref_t                   = 310.15

pcoupl                  = Parrinello-Rahman
pcoupltype              = semiisotropic
tau_p                   = 5.0
compressibility         = 4.5e-5  4.5e-5
ref_p                   = 1.0     1.0

constraints             = h-bonds
constraint_algorithm    = LINCS
continuation            = yes

nstcomm                 = 100
comm_mode               = linear
comm_grps               = SYSTEM

refcoord_scaling        = com
</code></pre>

                    <p>
                        
                    </p>

                </div>

                <div class="content-block">
                    <h3>まとめ</h3>
                    <p>
                        ここまで、アルコール二重膜の力場とトポロジーの設定を行い、GROMACSでシミュレーションを実行できるところまで辿り着いた。
                        今回の設定をまとめると次の通りである。
                    </p>
                    <div id="summary" class="table-of-contents">
                        <ol>
                            <li><code>CHARMM36力場</code>をダウンロードし、GROMACSで読み込めるようにした。</li>
                            <li>アルコール分子のトポロジーを<code>merged.rtp</code>に追加し、GROMACSで分子を扱えるようにした。</li>
                            <li>groファイルを作成し、系全体のトポロジーファイルを修正した。</li>
                        </ol>
                    </div>
                    <p>
                        次回は作成したgroファイルとトポロジーファイルを用いてシミュレーションを実行する。
                        シミュレーションの設定ファイルであるmdpファイルの詳細を学んでいこう。
                    </p>
                </div>
                
                <div class="hierarchie-bottom">
                    <a href="gromacs_tutorial2_1.html">PREVIOUS</a>
                    <a href="gromacs_tutorial2_top.html">TOP</a>
                    <a href="gromacs_tutorial2_3.html">NEXT</a>
                </div>

            </div>
            <script type="text/javascript">loadFooter();</script>
        </div>
    </div>
</body>
</html>